@model List<SelectListItem>

@{
    ViewBag.Title = "Current";
}

<h2 style="color:#6f0c3b"><b>Timesheet</b></h2>

@if (Model.Count() == 0)
{
    <div class="alert alert-danger">
        Nie jesteś przypisany do żadnego projektu! Nie masz możliwości edycji swojego timesheetu.
    </div>
}
else
{
    //information alerts
    <div class="alert alert-info">
        W tej sekcji masz możliwość edycji swojego timesheetu. Możesz wybrać projekt do którego jesteś przypisany,
        a następnie pracować nad zdefiniowanymi wcześniej zadaniami lub dodać nowe.
    </div>
    //timesheet
    //redundant security
    if (ViewBag.timesheetStart != null && ViewBag.timesheetFinish != null  && ViewBag.projectName != null)
    {
        //dropdown menu
        <div class="panel panel-default" style="width:auto">
        <div class="panel-heading">Wybierz projekt, a następnie kliknij przejdź, by wyświetlić <b>Timesheet</b></div>
        <div class="panel-body">
        @using (Html.BeginForm("ChangeTimesheet", "Timesheet"))
        {
            @Html.DropDownList("projectID", Model, htmlAttributes: new { @class = "form-control dropdown", @style = "width:auto; display:inline-table;" })
            <input type="submit" value="Przejdź" class="btn btn-default btn-main" style="margin:10px 10px 10px; width:auto" />
        }
        </div>
        </div>
        <div class="panel panel-primary">
            <div class="panel-heading">
                <div class="col">                     
                    <div class="row">                  
                        <div class="col-sm-10">    
                            <!--name of project-->
                            <b style="font-size: 20px">@ViewBag.projectName</b><br>
                            <!-- time -->
                            <b>od:</b> @ViewBag.timesheetStart <b>do:</b> @ViewBag.timesheetFinish
                        </div>
                    </div>
                </div>                     
            </div>
            <!--body of the timesheet-->
            <div class="panel-body" style="overflow:auto">
                <div-- class="table-responsive">
                    <table class="table table-hover Ttable">
                        <thead>
                            <tr>
                                <th colspan="2">Zadanie:</th>
                                <th>pn.</th>
                                <th>wt.</th>
                                <th>śr.</th>
                                <th>czw.</th>
                                <th>pt.</th>
                                <th>sob.</th>
                                <th>niedz.</th>
                                <th>Łącznie</th>
                                <th>Komentarz</th>
                                <th>Operacja</th>
                            </tr>
                        </thead>
                        <tbody>
                            @{ int counter = 0;}
                            <!-- rows of tasks if person has them -->
                            @if (Session["tasks"] != null)
                            {
                                foreach (var item in (List<timesheet_net.Models.Tasks>)Session["tasks"])
                                {
                            <tr>
                                @using (Html.BeginForm("DeleteTask", "Timesheet"))
                                {
                                <!-- TaskName -->
                                <td colspan="2">
                                    <!--div class="form-group"-->
                                        @Html.Hidden("data", item.TaskID) <!-- id of the task -->
                                        @Html.Hidden("deleteData", counter++)
                                        <input type="text" class="form-control" name="data" value="@item.TaskName" style="height:26px;font-size:12px; min-width: 80px" placeholder="Nazwa zadania" required>
                                    <!---/div-->
                                </td>
                                <!-- [day]Hours --><!-- http://stackoverflow.com/a/13390173 -->
                                <td><input type="text" name="data" value="@item.MondayHours.ToString()" pattern="^(0|[1-9]|1[0-9]|2[0-3])(,(25|5|75|0)0*)?$|24" required style="width: 3.5em" /></td>
                                <td><input type="text" name="data" value="@item.TuesdayHours.ToString()" pattern="^(0|[1-9]|1[0-9]|2[0-3])(,(25|5|75|0)0*)?$|24" required style="width: 3.5em" /></td>
                                <td><input type="text" name="data" value="@item.WednesdayHours.ToString()" pattern="^(0|[1-9]|1[0-9]|2[0-3])(,(25|5|75|0)0*)?$|24" required style="width: 3.5em" /></td>
                                <td><input type="text" name="data" value="@item.ThursdayHours.ToString()" pattern="^(0|[1-9]|1[0-9]|2[0-3])(,(25|5|75|0)0*)?$|24" required style="width: 3.5em" /></td>
                                <td><input type="text" name="data" value="@item.FridayHours.ToString()" pattern="^(0|[1-9]|1[0-9]|2[0-3])(,(25|5|75|0)0*)?$|24" required style="width: 3.5em" /></td>
                                <td><input type="text" name="data" value="@item.SaturdayHours.ToString()" pattern="^(0|[1-9]|1[0-9]|2[0-3])(,(25|5|75|0)0*)?$|24" required style="width: 3.5em" /></td>
                                <td><input type="text" name="data" value="@item.SundayHours.ToString()" pattern="^(0|[1-9]|1[0-9]|2[0-3])(,(25|5|75|0)0*)?$|24" required style="width: 3.5em" /></td>                              
                                <!-- Hours summary -->
                                <td>
                                    <p class="form-control-static-ts" style="margin:0px">   
                                    <!-- http://stackoverflow.com/a/4386890 -->
                                    @((item.MondayHours + item.TuesdayHours + item.WednesdayHours + item.ThursdayHours + item.FridayHours + item.SaturdayHours + item.SundayHours).ToString())
                                    </p>
                                </td>
                                <!-- Look -->
                                <td>
                                    <button data-toggle="collapse" data-target="#@item.TaskID.ToString()" class="btn btn-default btn-main" name="data" style="width:75px;font-size:12px; height:25px; padding-top:3px; background-color:#2e395b"><span class="glyphicon glyphicon-pencil"></span></button>
                                    <!--input type="submit" value="Zobacz" class="btn btn-default btn-main" style="width:auto;font-size:12px; height:25px; padding-top:3px; background-color:#808080" disabled-->
                                </td>
                                <td>
                                       <input type="submit" value="Usuń" class="btn btn-deletetask" >                                
                                </td>
                                }
                            </tr>
                            <tr>
                                <td colspan="12">
                                    <div id="@item.TaskID.ToString()" class="collapse">
                                        <div class="form-group">
                                            <input type="text" class="form-control" name="data" value="@item.Comment" style="height:26px;max-width:none;font-size:12px;" placeholder="Komentarz">
                                        </div>
                                    </div>
                                </td>
                            </tr>
                                }
                            }
                            <!--addition row to add new task-->
                            <tr>
                                @using (Html.BeginForm("AddTask", "Timesheet"))
                                {
                                <td colspan="2">
                                    <!---div class="form-group"-->
                                        <input type="text" class="form-control" style="height:26px;font-size:12px; min-width:80px" name="data" placeholder="Nazwa zadania" required>
                                    <!--/div-->
                                </td>
                                    for (int i = 0; i < 7; i++)
                                    {
                                        <td><input type="text" value="0,00"style="width: 3.5em" disabled></td>     
                                    }
                                <td><p class="form-control-static-ts" style="background-color:#bbb6b6; margin:0px">0</p></td>
                                <td>
                                    <button data-toggle="collapse" data-target="#comment"class="btn btn-default btn-main" style="width:75px;font-size:12px; height:25px; padding-top:3px; background-color:#808080" disabled ><span class="glyphicon glyphicon-pencil"></span></button>
                                <!--input type="submit" value="Zobacz" class="btn btn-default btn-main" style="width:auto;font-size:12px; height:25px; padding-top:3px; background-color:#808080" disabled-->
                                </td>
                                <td>    
                                    <input type="submit" value="Dodaj" class="btn btn-addtask";>
                                </td>
                                }
                            </tr> 
                            <tr>
                                <td colspan="12">
                                    <div id="comment" class="collapse">
                                        <div class="form-group">
                                            <input type="text" class="form-control" style="height:26px;max-width:none;font-size:12px;" name="Comment" placeholder="Komentarz">
                                        </div>
                                    </div>
                                </td>
                            </tr>
                                <!--summary row-->
                            <tr>
                                <td colspan="2" style="text-align:right;"><b>Łącznie:</b></td>
                                @for (int i = 0; i < 7; i++)
                                {
                                    <td>
                                        <p class="form-control-static-ts" style="width:49px; margin:0px">
                                        @ViewData[i.ToString()]
                                        </p>
                                    </td>
                                }                         
                                <td><p class="form-control-static-ts" style="margin:0px">@ViewBag.allH</p>
                                </td>
                                <td></td>
                                <td></td>
                            </tr>                  
                        </tbody>
                    </table>
                    </div>
                </div>
            <!--alert and save the work-->
            <div class="panel-footer" style="overflow:auto">
                <div class="col">
                    <div class="row">
                        <div class="col-sm-10">
                            <!--alert about saving employee work-->
                            <div class="alert alert-danger" style="margin-bottom:0px">
                                <strong>Uwaga!</strong> Zapisz rezultat swojej pracy, w przeciwnym wypadku zmiany zostaną utracone!
                            </div>
                        </div>
                        <div class="col-sm-2" style="text-align:center; padding: 10px;">
                            <input type="submit" value="Zapisz zmiany" class="btn btn-default btn-redalert" style="margin-right:10px"/>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    }
}